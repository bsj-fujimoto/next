# アバターアイコンとドロップダウンメニュー機能のテスト計画

## ユースケース

### ユースケース1: アバターアイコンの表示とドロップダウンメニューの開閉

**前提条件**: ユーザーがダッシュボードにログインしている

**基本フロー**:
1. ユーザーがダッシュボードページにアクセスする
2. ヘッダーにアバターアイコンが表示されていることを確認する
3. ユーザーがアバターアイコンをクリックする
4. ドロップダウンメニューが表示されることを確認する
5. ユーザーが再度アバターアイコンをクリックする
6. ドロップダウンメニューが閉じることを確認する

**代替フロー**:
- 3a. ユーザーがメニュー外をクリックする
  - 4a. ドロップダウンメニューが閉じることを確認する

### ユースケース2: プロフィール画面への遷移

**前提条件**: ユーザーがダッシュボードにログインしている

**基本フロー**:
1. ユーザーがアバターアイコンをクリックする
2. ドロップダウンメニューが表示される
3. ユーザーが「プロフィール」メニュー項目をクリックする
4. プロフィールページに遷移することを確認する

### ユースケース3: セッティング画面への遷移

**前提条件**: ユーザーがダッシュボードにログインしている

**基本フロー**:
1. ユーザーがアバターアイコンをクリックする
2. ドロップダウンメニューが表示される
3. ユーザーが「セッティング」メニュー項目をクリックする
4. セッティングページに遷移することを確認する

### ユースケース4: ログアウト機能

**前提条件**: ユーザーがダッシュボードにログインしている

**基本フロー**:
1. ユーザーがアバターアイコンをクリックする
2. ドロップダウンメニューが表示される
3. ユーザーが「ログアウト」メニュー項目をクリックする
4. ログアウト処理が実行され、ログインページにリダイレクトされることを確認する

## テストケース

### E2Eテスト（Playwright）

#### TC-E2E-001: アバターアイコンの表示確認
- **テスト内容**: ダッシュボードページでアバターアイコンが表示されていることを確認
- **期待結果**: アバターアイコンがヘッダーに表示されている

#### TC-E2E-002: ドロップダウンメニューの開閉
- **テスト内容**: アバターアイコンをクリックしてドロップダウンメニューを開閉する
- **期待結果**: 
  - クリック時にメニューが表示される
  - 再度クリック時にメニューが閉じる

#### TC-E2E-003: クリックアウトサイドでメニューを閉じる
- **テスト内容**: メニュー外をクリックしてメニューを閉じる
- **期待結果**: メニューが閉じる

#### TC-E2E-004: プロフィールページへの遷移
- **テスト内容**: ドロップダウンメニューから「プロフィール」をクリック
- **期待結果**: `/profile`ページに遷移する

#### TC-E2E-005: セッティングページへの遷移
- **テスト内容**: ドロップダウンメニューから「セッティング」をクリック
- **期待結果**: `/settings`ページに遷移する

#### TC-E2E-006: ログアウト機能
- **テスト内容**: ドロップダウンメニューから「ログアウト」をクリック
- **期待結果**: ログアウト処理が実行され、`/login`ページにリダイレクトされる

#### TC-E2E-007: キーボードナビゲーション
- **テスト内容**: Tabキーでアバターアイコンにフォーカスし、Enterキーでメニューを開く
- **期待結果**: キーボード操作でメニューが開閉できる

#### TC-E2E-008: スクロール時のメニュー閉鎖
- **テスト内容**: メニューを開いた状態でページをスクロールする
- **期待結果**: メニューが自動的に閉じる

### ユニットテスト（Jest + React Testing Library）

#### TC-UNIT-001: AvatarDropdownコンポーネントのレンダリング
- **テスト内容**: AvatarDropdownコンポーネントが正しくレンダリングされる
- **期待結果**: アバターアイコンが表示される

#### TC-UNIT-002: メニューの開閉状態の管理
- **テスト内容**: メニューの開閉状態が正しく管理される
- **期待結果**: 
  - 初期状態ではメニューが閉じている
  - クリック時にメニューが開く
  - 再度クリック時にメニューが閉じる

#### TC-UNIT-003: メニュー項目の表示
- **テスト内容**: メニュー項目（プロフィール、セッティング、ログアウト）が正しく表示される
- **期待結果**: 3つのメニュー項目が表示される

#### TC-UNIT-004: クリックアウトサイドの処理
- **テスト内容**: メニュー外をクリックした時にメニューが閉じる
- **期待結果**: メニューが閉じる

#### TC-UNIT-005: ログアウトハンドラーの呼び出し
- **テスト内容**: ログアウトメニュー項目をクリックした時にログアウトハンドラーが呼ばれる
- **期待結果**: ログアウトハンドラーが1回呼ばれる

### ビジュアルリグレッションテスト

#### TC-VISUAL-001: アバターアイコンの表示
- **テスト内容**: アバターアイコンのスクリーンショットを取得
- **期待結果**: アバターアイコンが正しく表示されている

#### TC-VISUAL-002: ドロップダウンメニューの表示
- **テスト内容**: ドロップダウンメニューを開いた状態のスクリーンショットを取得
- **期待結果**: メニューが正しく表示されている

### アクセシビリティテスト

#### TC-A11Y-001: ARIA属性の確認
- **テスト内容**: アバターアイコンとメニューに適切なARIA属性が設定されている
- **期待結果**: 
  - `aria-label`または`aria-labelledby`が設定されている
  - `aria-expanded`が状態に応じて更新される
  - `role="menu"`がメニューに設定されている

#### TC-A11Y-002: キーボードナビゲーション
- **テスト内容**: キーボードでメニューを操作できる
- **期待結果**: 
  - Tabキーでアバターアイコンにフォーカスできる
  - Enter/Spaceキーでメニューを開閉できる
  - 矢印キーでメニュー項目間を移動できる
  - Escapeキーでメニューを閉じられる

#### TC-A11Y-003: フォーカス管理
- **テスト内容**: メニューを開いた時にフォーカスがメニュー内に移動する
- **期待結果**: フォーカスが適切に管理される

## テスト実装計画

### E2Eテストの実装
- ファイル: `next/tests/e2e/dashboard.spec.ts`に追加
- 既存のダッシュボードテストに統合

### ユニットテストの実装
- ファイル: `next/tests/unit/AvatarDropdown.test.tsx`（新規作成）
- React Testing Libraryを使用

### ビジュアルリグレッションテストの実装
- Playwrightのスクリーンショット機能を使用
- ファイル: `next/tests/e2e/dashboard.spec.ts`に追加

### アクセシビリティテストの実装
- Playwrightのアクセシビリティテスト機能を使用
- またはaxe DevToolsを使用

