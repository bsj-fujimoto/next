# サイドドロワーメニュー機能の実装計画

## 機能概要

ダッシュボード画面にサイドメニュー（画面左に隠れるドロワーメニュー）を実装します。ヘッダーの一番左にドロワー開閉ボタンを設置し、画面幅に応じてメインコンテンツに重ねて表示するか、2列レイアウトで幅を分けるかを自動的に選択します。

## ユーザーの指示内容

- ダッシュボード画面にサイドメニュー（画面左に隠れるドロワーメニュー）を実装
- ヘッダーの一番左にドロワー開閉ボタンを設置
- ドロワーはデフォルトで開いている
- 画面全体の幅に応じてメインコンテンツに重ねて表示するか、2列にして幅を分けるかを選択
- 画面が十分に広い場合はメインコンテンツの幅を縮めてドロワーメニューを左側に表示

## 非機能要件

### パフォーマンス要件
- ドロワーメニューの開閉アニメーションは滑らかで自然な動き（300ms程度）
- リサイズ時のレイアウト切り替えは即座に反応する
- メインコンテンツの再レンダリングを最小限に抑える

### アクセシビリティ要件
- WCAG AA準拠
- キーボードナビゲーション対応（Tabキーでフォーカス移動、Enter/Spaceで選択、Escapeで閉じる）
- スクリーンリーダー対応（aria-label, aria-expanded, role属性の適切な使用）
- フォーカス管理の適切な実装（ドロワーが開いたときにフォーカスをドロワー内に移動、閉じたときに元の位置に戻す）
- フォーカストラップ（ドロワーが開いている間はフォーカスがドロワー内に留まる）

### セキュリティ要件
- 認証状態の確認は既存のフックを使用
- XSS対策（dangerouslySetInnerHTMLの使用を最小限に）

### ブラウザサポート範囲
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### モバイル対応
- タッチデバイスでも操作可能
- レスポンシブデザインに対応
- モバイルではデフォルトで閉じている（またはオーバーレイ表示）

## 依存関係

### 既存のコンポーネント・ライブラリ
- `Header.tsx`コンポーネントを拡張してドロワー開閉ボタンを追加
- `DropdownMenu.tsx`コンポーネントの実装パターンを参考にする（キーボードナビゲーション、フォーカス管理など）
- 既存のデザインパターン（ガラスモーフィズム効果）を維持

### 新しいnpmパッケージ
- 必要に応じて検討（現時点では不要と判断）

### APIエンドポイント
- 変更不要

## エッジケースとエラーハンドリング

### エッジケース
- 画面幅が非常に狭い場合（モバイル）: オーバーレイ表示、背景を暗くする
- 画面幅が中程度の場合（タブレット）: オーバーレイ表示またはサイドバー表示を選択
- 画面幅が広い場合（デスクトップ）: 2列レイアウトで表示
- ドロワーが開いている状態で画面幅が変更された場合: 適切なレイアウトに自動切り替え
- ドロワーが開いている状態でページ遷移した場合: 状態をリセット

### エラーハンドリング
- メニュー項目のクリック時のエラー処理
- ナビゲーション時のエラー処理

### ユーザーフィードバック
- ドロワーの開閉状態を視覚的に明確に表示
- アニメーションで状態変化を伝える

## 実装方針

### コンポーネント設計
1. **SideDrawerコンポーネント**（新規作成）
   - ドロワーメニューの表示・非表示を管理
   - レスポンシブレイアウトの切り替えを管理
   - キーボードナビゲーションとフォーカス管理を実装

2. **Headerコンポーネントの拡張**
   - ドロワー開閉ボタンを追加
   - ドロワーの開閉状態を管理するためのpropsを追加

3. **DashboardPageの修正**
   - SideDrawerコンポーネントを統合
   - レイアウト構造を調整（ドロワーとメインコンテンツの配置）

### レスポンシブデザイン
- **ブレークポイント**: Tailwind CSSの標準ブレークポイントを使用
  - `sm`: 640px以上
  - `md`: 768px以上
  - `lg`: 1024px以上
  - `xl`: 1280px以上

- **レイアウト切り替え方針**:
  - モバイル（< 1024px）: オーバーレイ表示、背景を暗くする
  - デスクトップ（>= 1024px）: 2列レイアウト、メインコンテンツの幅を調整

### 状態管理
- ドロワーの開閉状態: `useState`でローカル管理
- レスポンシブレイアウトの判定: `useEffect`と`window.matchMedia`を使用

### アニメーション
- Tailwind CSSの`transition`クラスを使用
- `transform`と`opacity`を使用したスムーズなアニメーション

### メニュー項目
- ダッシュボード
- プロフィール
- セッティング
- （必要に応じて追加）

## 技術的な詳細

### z-indexの設定
- ドロワーメニュー: `z-50`（ヘッダーの`z-40`より上）
- オーバーレイ背景: `z-40`（ヘッダーと同じレベル）

### レイアウト構造
```
<div className="relative min-h-screen">
  <AnimatedBackground />
  <Header withDrawerToggle />
  <div className="flex">
    <SideDrawer />
    <main className="flex-1">
      {/* メインコンテンツ */}
    </main>
  </div>
</div>
```

### アクセシビリティ実装
- `aria-label`: ドロワー開閉ボタンに適切なラベルを設定
- `aria-expanded`: ドロワーの開閉状態を明示
- `role="navigation"`: ドロワーメニューにナビゲーションロールを設定
- `role="button"`: ドロワー開閉ボタンにボタンロールを設定
- `tabIndex`: キーボードナビゲーションのための適切な設定

## 実装の優先順位

1. **高優先度**
   - SideDrawerコンポーネントの基本実装
   - ヘッダーへのドロワー開閉ボタンの追加
   - レスポンシブレイアウトの実装

2. **中優先度**
   - キーボードナビゲーション
   - フォーカス管理
   - アニメーションの調整

3. **低優先度**
   - メニュー項目の追加
   - デザインの微調整

## 確認事項

- [ ] 既存のコンポーネントで実装できないか確認済み
- [ ] デザインパターンが既存コンポーネントと一貫している
- [ ] アクセシビリティ要件を満たしている
- [ ] レスポンシブデザインに対応している
- [ ] パフォーマンスへの影響を考慮している
