# サイドドロワーメニュー機能のテスト計画

## テスト概要

サイドドロワーメニュー機能のテスト計画です。ユニットテスト、E2Eテスト、ビジュアルリグレッションテストを含みます。

## テストの種類

### 1. ユニットテスト（Jest + React Testing Library）
- SideDrawerコンポーネントの個別テスト
- Headerコンポーネントの拡張部分のテスト

### 2. E2Eテスト（Playwright）
- ユーザーシナリオ全体のテスト
- レスポンシブレイアウトのテスト

### 3. ビジュアルリグレッションテスト（Playwright）
- UIの見た目の変更検知
- レイアウトの崩れの検知

## テストケース

### ユニットテスト

#### SideDrawerコンポーネント

**TC-U-001: ドロワーの初期状態（開いている）**
- **前提条件**: なし
- **実行手順**: SideDrawerコンポーネントをレンダリング
- **期待結果**: ドロワーが開いている状態で表示される
- **テスト種別**: ユニットテスト

**TC-U-002: ドロワーの閉じる動作**
- **前提条件**: ドロワーが開いている
- **実行手順**: 閉じるボタンをクリック
- **期待結果**: ドロワーが閉じる
- **テスト種別**: ユニットテスト

**TC-U-003: ドロワーの開く動作**
- **前提条件**: ドロワーが閉じている
- **実行手順**: 開くボタンをクリック
- **期待結果**: ドロワーが開く
- **テスト種別**: ユニットテスト

**TC-U-004: メニュー項目のクリック**
- **前提条件**: ドロワーが開いている
- **実行手順**: メニュー項目をクリック
- **期待結果**: メニュー項目のonClickが呼ばれる
- **テスト種別**: ユニットテスト

**TC-U-005: キーボードナビゲーション（Escapeキー）**
- **前提条件**: ドロワーが開いている
- **実行手順**: Escapeキーを押す
- **期待結果**: ドロワーが閉じる
- **テスト種別**: ユニットテスト

**TC-U-006: キーボードナビゲーション（Tabキー）**
- **前提条件**: ドロワーが開いている
- **実行手順**: Tabキーでフォーカス移動
- **期待結果**: メニュー項目間でフォーカスが移動する
- **テスト種別**: ユニットテスト

**TC-U-007: フォーカス管理（開いた時）**
- **前提条件**: ドロワーが閉じている
- **実行手順**: ドロワーを開く
- **期待結果**: フォーカスがドロワー内の最初の要素に移動する
- **テスト種別**: ユニットテスト

**TC-U-008: フォーカス管理（閉じた時）**
- **前提条件**: ドロワーが開いている
- **実行手順**: ドロワーを閉じる
- **期待結果**: フォーカスが元の位置（開閉ボタン）に戻る
- **テスト種別**: ユニットテスト

**TC-U-009: レスポンシブレイアウト（モバイル）**
- **前提条件**: 画面幅が1024px未満
- **実行手順**: SideDrawerコンポーネントをレンダリング
- **期待結果**: オーバーレイ表示になる
- **テスト種別**: ユニットテスト

**TC-U-010: レスポンシブレイアウト（デスクトップ）**
- **前提条件**: 画面幅が1024px以上
- **実行手順**: SideDrawerコンポーネントをレンダリング
- **期待結果**: 2列レイアウトになる
- **テスト種別**: ユニットテスト

**TC-U-011: オーバーレイ背景のクリック**
- **前提条件**: ドロワーが開いている（モバイル表示）
- **実行手順**: オーバーレイ背景をクリック
- **期待結果**: ドロワーが閉じる
- **テスト種別**: ユニットテスト

**TC-U-012: ARIA属性の設定**
- **前提条件**: なし
- **実行手順**: SideDrawerコンポーネントをレンダリング
- **期待結果**: 適切なARIA属性が設定されている（aria-label, aria-expanded, roleなど）
- **テスト種別**: ユニットテスト

#### Headerコンポーネント

**TC-U-013: ドロワー開閉ボタンの表示**
- **前提条件**: HeaderコンポーネントにwithDrawerToggleプロップを渡す
- **実行手順**: Headerコンポーネントをレンダリング
- **期待結果**: ドロワー開閉ボタンが表示される
- **テスト種別**: ユニットテスト

**TC-U-014: ドロワー開閉ボタンのクリック**
- **前提条件**: Headerコンポーネントがレンダリングされている
- **実行手順**: ドロワー開閉ボタンをクリック
- **期待結果**: onDrawerToggleが呼ばれる
- **テスト種別**: ユニットテスト

### E2Eテスト

**TC-E2E-001: ドロワーメニューの基本動作**
- **前提条件**: ダッシュボード画面にアクセス
- **実行手順**:
  1. ページを読み込む
  2. ドロワーが開いていることを確認
  3. ヘッダーの開閉ボタンをクリック
  4. ドロワーが閉じることを確認
  5. 再度開閉ボタンをクリック
  6. ドロワーが開くことを確認
- **期待結果**: ドロワーが正常に開閉する
- **テスト種別**: E2Eテスト

**TC-E2E-002: メニュー項目からのナビゲーション**
- **前提条件**: ダッシュボード画面にアクセス、ドロワーが開いている
- **実行手順**:
  1. プロフィールメニュー項目をクリック
  2. プロフィール画面に遷移することを確認
  3. ブラウザの戻るボタンでダッシュボードに戻る
  4. セッティングメニュー項目をクリック
  5. セッティング画面に遷移することを確認
- **期待結果**: メニュー項目から正しくナビゲーションできる
- **テスト種別**: E2Eテスト

**TC-E2E-003: レスポンシブレイアウト（モバイル）**
- **前提条件**: なし
- **実行手順**:
  1. 画面幅を375pxに設定（モバイルサイズ）
  2. ダッシュボード画面にアクセス
  3. ドロワーがオーバーレイ表示になることを確認
  4. オーバーレイ背景をクリック
  5. ドロワーが閉じることを確認
- **期待結果**: モバイルサイズで適切にオーバーレイ表示される
- **テスト種別**: E2Eテスト

**TC-E2E-004: レスポンシブレイアウト（デスクトップ）**
- **前提条件**: なし
- **実行手順**:
  1. 画面幅を1280pxに設定（デスクトップサイズ）
  2. ダッシュボード画面にアクセス
  3. ドロワーが2列レイアウトで表示されることを確認
  4. メインコンテンツの幅が調整されていることを確認
- **期待結果**: デスクトップサイズで適切に2列レイアウトで表示される
- **テスト種別**: E2Eテスト

**TC-E2E-005: 画面幅変更時のレイアウト切り替え**
- **前提条件**: ダッシュボード画面にアクセス
- **実行手順**:
  1. 画面幅を1280pxに設定（デスクトップサイズ）
  2. 2列レイアウトであることを確認
  3. 画面幅を375pxに変更（モバイルサイズ）
  4. オーバーレイ表示に切り替わることを確認
  5. 画面幅を1280pxに戻す
  6. 2列レイアウトに戻ることを確認
- **期待結果**: 画面幅変更時に適切にレイアウトが切り替わる
- **テスト種別**: E2Eテスト

**TC-E2E-006: キーボードナビゲーション**
- **前提条件**: ダッシュボード画面にアクセス、ドロワーが開いている
- **実行手順**:
  1. Tabキーでフォーカスを移動
  2. メニュー項目間でフォーカスが移動することを確認
  3. Enterキーでメニュー項目を選択
  4. ナビゲーションが実行されることを確認
  5. Escapeキーを押す
  6. ドロワーが閉じることを確認
- **期待結果**: キーボードで正常に操作できる
- **テスト種別**: E2Eテスト

**TC-E2E-007: コンソールエラーの確認**
- **前提条件**: なし
- **実行手順**:
  1. ダッシュボード画面にアクセス
  2. ドロワーを開閉する
  3. コンソールエラーがないことを確認
- **期待結果**: コンソールエラーが発生しない
- **テスト種別**: E2Eテスト

**TC-E2E-008: z-indexの確認**
- **前提条件**: ダッシュボード画面にアクセス、ドロワーが開いている
- **実行手順**:
  1. ドロワーが他の要素より前面に表示されることを確認
  2. z-indexの値を取得して検証
- **期待結果**: ドロワーが適切なz-indexで表示される（z-50以上）
- **テスト種別**: E2Eテスト

**TC-E2E-009: レイアウトの崩れの確認**
- **前提条件**: なし
- **実行手順**:
  1. ダッシュボード画面にアクセス
  2. スクリーンショットを取得
  3. レイアウトの崩れがないことを確認
  4. 複数の画面サイズで確認（375px, 768px, 1280px）
- **期待結果**: レイアウトが崩れていない
- **テスト種別**: E2Eテスト（ビジュアルリグレッションテスト）

**TC-E2E-010: フォーカストラップ**
- **前提条件**: ダッシュボード画面にアクセス、ドロワーが開いている（モバイル表示）
- **実行手順**:
  1. Tabキーでフォーカスを移動
  2. フォーカスがドロワー内に留まることを確認
  3. Shift+Tabで逆方向に移動
  4. フォーカスがドロワー内に留まることを確認
- **期待結果**: フォーカスがドロワー内にトラップされる
- **テスト種別**: E2Eテスト

### ビジュアルリグレッションテスト

**TC-VR-001: ダッシュボード画面（デスクトップ、ドロワー開）**
- **前提条件**: 画面幅1280px、ドロワーが開いている
- **実行手順**: スクリーンショットを取得
- **期待結果**: レイアウトが正しく表示される
- **テスト種別**: ビジュアルリグレッションテスト

**TC-VR-002: ダッシュボード画面（デスクトップ、ドロワー閉）**
- **前提条件**: 画面幅1280px、ドロワーが閉じている
- **実行手順**: スクリーンショットを取得
- **期待結果**: レイアウトが正しく表示される
- **テスト種別**: ビジュアルリグレッションテスト

**TC-VR-003: ダッシュボード画面（モバイル、ドロワー開）**
- **前提条件**: 画面幅375px、ドロワーが開いている
- **実行手順**: スクリーンショットを取得
- **期待結果**: レイアウトが正しく表示される
- **テスト種別**: ビジュアルリグレッションテスト

**TC-VR-004: ダッシュボード画面（モバイル、ドロワー閉）**
- **前提条件**: 画面幅375px、ドロワーが閉じている
- **実行手順**: スクリーンショットを取得
- **期待結果**: レイアウトが正しく表示される
- **テスト種別**: ビジュアルリグレッションテスト

**TC-VR-005: ダッシュボード画面（タブレット、ドロワー開）**
- **前提条件**: 画面幅768px、ドロワーが開いている
- **実行手順**: スクリーンショットを取得
- **期待結果**: レイアウトが正しく表示される
- **テスト種別**: ビジュアルリグレッションテスト

## テスト実装計画

### ユニットテスト
- `next/tests/unit/SideDrawer.test.tsx`を作成
- `next/tests/unit/Header.test.tsx`を更新

### E2Eテスト
- `next/tests/e2e/dashboard.spec.ts`を更新
- 新しいテストケースを追加

### ビジュアルリグレッションテスト
- `next/tests/e2e/visual-regression.spec.ts`を更新
- 新しいスクリーンショットテストを追加

## テスト実行計画

1. **Step 3**: テストコードを実装し、全てのテストが失敗することを確認
2. **Step 5**: 機能実装後、テストコードを実行し、全てのテストが成功することを確認
3. **Step 8**: リファクタリング後、全てのテストを再実行し、成功することを確認

## エビデンスの取得

### E2Eテスト
- Playwrightの動画記録を有効化
- 重要なテストケースでスクリーンショットを取得
- テスト結果を`test-results/`に保存

### ユニットテスト
- カバレッジレポートを生成（`npm test -- --coverage`）
- カバレッジレポートを`coverage/`に保存

### ビジュアルリグレッションテスト
- スクリーンショットを`test-results/`に保存
- 複数の画面サイズでスクリーンショットを取得

## 必須確認事項

- ✅ テストケースが全て失敗すること（Step 3）
- ✅ テストケースが全て成功すること（Step 5, 8）
- ✅ コンソールエラーがないこと（必須）
- ✅ Dropdownやポップアップが他の要素より前面に表示されること（必須）
- ✅ レイアウトの崩れがないことをスクリーンショットで確認（必須）
- ✅ テストエビデンス（スクリーンショット、動画、テスト結果）をPRに添付（必須）
